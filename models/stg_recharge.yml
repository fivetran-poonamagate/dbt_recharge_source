
version: 2

models:
  - name: stg_recharge__address
    description: Table of all addresses, an address represents a shipping address. Each customer can have multiple addresses, subscriptions are a child object of an address.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - address_id

    columns:
      - name: address_id
        description: The unique ID of the address.
        tests:
          - not_null
      - name: customer_id
        description: Unique numeric identifier for the customer associated with the address.
      - name: customer_full_name
        description: The full name of the customer.
      - name: created_at
        description: The date and time the customer address was recorded.
      - name: updated_at
        description: The date and time of when the customer's address record was last updated.
      - name: address_line_1
        description: The first line of the customer's address.
      - name: address_line_1
        description: Any additional address information associated with the customer.
      - name: city
        description: The city associated with the customer.
      - name: province
        description: The province or state name associated with the customer.
      - name: zip
        description: The zip or post code associated with the customer.
      - name: country
        description: The country associated with the customer.
      - name: company
        description: The company name associated with the customer.
      - name: phone
        description: The phone number associated with the customer.
      - name: customer_visitor_info
        description: Custom field to record additional customer information such as where they visited the vendor's website.
      - name: _fivetran_deleted
        description: Boolean indicating if a row have been deleted in the source.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__address_shipping_line
    description: Table of all addresses and corresponding associated shipping information.
    tests:
     - dbt_utils.unique_combination_of_columns:
        combination_of_columns:
          - address_id
          - index

    columns:
      - name: address_id
        description: The unique ID of the address.
        tests:
          - not_null
      - name: index
        description: A unique numeric row produced for every concurrent address_id.
      - name: price
        description: The price of the shipping amount.
      - name: code
        description: The type of the shipping, can contain geographical shipping information. 
      - name: title
        description: The type of shipping consignment.
      - name: _fivetran_deleted
        description: Boolean indicating if a row have been deleted in the source.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__charge
    description: Table of all charges (financial transactions) linked to the purchase of an item. A charge is linked to a corresponding order, an order is created once the corresponding charge is successful.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - charge_id

    columns:
      - name: charge_id
        description: The unique ID of the charge.
        tests:
          - not_null
      - name: customer_id
        description: The ID of the customer associated with the charge.
      - name: customer_hash
        description: The hash of the customer associated with the charge.
      - name: customer_full_name
        description: The full name of the customer.
      - name: email
        description: The hash of the customer associated with the charge.
      - name: created_at
        description: Date and time when the charge was created.
      - name: charge_type
        description: The type of the charge, possible values can be; checkout or recurring.
        tests:
          - accepted_values:
              values: ['CHECKOUT','RECURRING']
              config:
                severity: warn
      - name: charge_status
        description: The status of the charge, possible values can be; success, error, queued, skipped, refunded or partially_refunded.
        tests:
          - accepted_values:
              values: ['SUCCESS','ERROR','QUEUED','SKIPPED','REFUNDED','PARTIALLY_REFUNDED','PENDING_MANUAL_PAYMENT','PENDING']
              config:
                severity: warn
      - name: updated_at
        description: Date and time when the charge was last updated.
      - name: note
        description: Shows the next order in sequence.
      - name: subtotal_price
        description: The item price without taxes and shipping applied.
      - name: tax_lines
        description: Array of strings used to distinguish specific charges - the price of the shipping line.
      - name: total_discounts
        description: The sum of the discounts applied to the charge.
      - name: total_line_items_price
        description: The sum of all the prices of all the items in the charge.
      - name: total_tax
        description: The sum of all the prices of all the items in the charge, taxes included.
      - name: total_price
        description: The sum of all the prices of all the items in the charge, taxes and discounts included (must be positive).
      - name: total_refunds
        description: The sum of all refunds that were made on a specific charge.
      - name: total_weight
        description: The total weight of all items in the charge.
      - name: scheduled_at
        description: When the charge processing will next be attempted.
      - name: processed_at
        description: Date and time when the charge was processed.
      - name: processor_name
        description: The payment processor used on the charge.
      - name: transaction_id
        description: The unique alphanumeric identifier of the transaction.
      - name: shopify_order_id
        description: The unique numeric identifier within Shopify for the charge.
      - name: shipments_count
        description: The number of successful processed child orders on the charge.
      - name: has_uncommitted_changes
        description: Specifies whether the charge is scheduled for regeneration (if the subscription is related to the charge was updated in the last 5 seconds using "commit_update":false).
      - name: last_charge_attempt_date
        description: The date when the charge was last attempted.
      - name: retry_date
        description: The date when the next attempt will be placed.
      - name: error_type
        description: Structured reason why the charge failed such as customer_needs_to_updated_card.
      - name: times_retried
        description: Shows how many times an attempt to charge was placed.
      - name: address_id
        description: The customer shipping address the charge is tied to.
      - name: billing_address_full_name
        description: The full name of the billing address.
      - name: billing_address_line_1
        description: Line 1 of the billing address.
      - name: billing_address_line_2
        description: Line 2 of the billing address.
      - name: billing_address_city
        description: The city of the billing address.
      - name: billing_address_province
        description: The province or state name associated with the billing address.
      - name: billing_address_zip
        description: The zip or post code of the billing address.
      - name: billing_address_country
        description: The country of the billing address.
      - name: billing_address_company
        description: The company name of the billing address.
      - name: billing_address_phone
        description: The phone number of the billing address.
      - name: shipping_address_full_name
        description: The full name of the shipping address.
      - name: shipping_address_line_1
        description: Line 1 of the shipping address.
      - name: shipping_address_line_2
        description: Line 2 of the shipping address.
      - name: shipping_address_city
        description: The city of the shipping address.
      - name: shipping_address_province
        description: The name of the province or state associated with the shipping address.
      - name: shipping_address_zip
        description: The zip or post code of the shipping address.
      - name: shipping_address_country
        description: The country of the shipping address.
      - name: shipping_address_company
        description: The company name of the shipping address.
      - name: shipping_address_phone
        description: The phone number of the shipping address.
      - name: client_details_browser_ip
        description: The IP address of the buyer detected in checkout.
      - name: client_details_user_agent
        description: The user agent detected during checkout.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__charge_discount_code
    description: Table of all charge discount codes.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - charge_id
            - index

    columns:
      - name: charge_id
        description: The unique ID of the charge.
        tests:
          - not_null
      - name: index
        description: A unique numeric row produced for every concurrent charge_id.
      - name: discount_id
        description: The ID of the discount associated to the charge.
      - name: amount
        description: The amount of the discount.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__charge_line_item
    description: Table of all charge line items, each containing information about a distinct purchase item.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - charge_id
            - index

    columns:
      - name: charge_id
        description: The unique ID of the charge.
        tests:
          - not_null
      - name: index
        description: A unique numeric row produced for every concurrent charge_id.
      - name: subscription_id
        description: The unique ID of the associated subscription.
      - name: vendor
        description: The name of the seller.
      - name: title
        description: The product title retrieved from Shopify.
      - name: title_v2
        description: The title of the product.
      - name: variant_title
        description: The name of the product variant.
      - name: sku
        description: The SKU (stock keeping unit) of the product associated with the charge's line item.
      - name: grams
        description: The weight of the charge's line item in grams.
      - name: quantity
        description: The number of items associated to the subscription and therefore the subsequent charge.
      - name: price
        description: The price of the charge's line item.
      - name: shopify_product_id
        description: The product ID retrieved from Shopify.
      - name: shopify_variant_id
        description: The variant ID retrieved from Shopify.
      - name: charge_interval_frequency
        description: The number of units, specified in order_interval_unit between each charge.
      - name: charge_interval_unit
        description: The condition of how frequent the items are charged.
      - name: shipping_interval_frequency
        description: The interval of how frequent the items are shipped.
      - name: shipping_interval_unit
        description: The condition of how frequent the items are shipped.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__charge_note_attribute
    description: Table of notes associated to their corresponding charges.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - charge_id
            - index
    
    columns:
      - name: charge_id
        description: The unique ID of the charge.
        tests:
          - not_null
      - name: index
        description: A unique numeric row produced for every concurrent charge_id.
      - name: note_attribute
        description: An array of name-value pairs of order attributes on the charge.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__charge_shipping_line
    description: Table of all shipping information associated to their corresponding charges.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - charge_id
            - index
    
    columns:
      - name: charge_id
        description: The unique ID of the charge.
        tests:
          - not_null
      - name: index
        description: A unique numeric row produced for every concurrent charge_id.
      - name: price
        description: The price of th shipping line of a charge.
      - name: code
        description: The code associated with the shipping line of a charge.
      - name: title
        description: The title of the shipping line.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__checkout
    description: Table of all checkouts to manage recurring orders, billing and payments, only available for BigCommerce and Custom. Checkouts on Shopify must go through Shopify.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - checkout_id

    columns:
      - name: checkout_id
        description: Unique ID for the checkout.
        tests:
          - not_null
      - name: charge_id 
        description: The unique ID of the charge.
      - name: email
        description: The email address for the customer.
      - name: phone
        description: The phone number for the customer.
      - name: created_at
        description: Timestamp for when the checkout was created.
      - name: completed_at
        description: Timestamp for when the checkout was processed.
      - name: updated_at
        description: Timestamp for the latest checkout update.
      - name: currency
        description: Currency of the checkout.
      - name: discount_code
        description: Returns addresses that have the provided discount_code.
      - name: applied_discount_amount
        description: Financial amount of the discount applied.
      - name: applied_discount_applicable
        description: Whether the discount can be applied to the checkout.
      - name: applied_discount_non_applicable_reason
        description: Reason why the discount could not be redeemed, if applicable.
      - name: applied_discount_value
        description: The value of the discount, used in combination with the value_type to determine the amount.
      - name: applied_discount_value_type
        description: The way the discount amount is calculated.
      - name: external_checkout_id
        description: External checkout reference, if one exists.
      - name: external_checkout_source
        description: External checkout platform, if one exists.
      - name: buyers_accepts_marketing
        description: Boolean indicating if the buyer accepts marketing.
      - name: subtotal_price
        description: Value of the checkout minus shipping and tax.
      - name: taxes_included
        description: Boolean indicating if the checkout contains items that are taxable.
      - name: total_tax
        description: Tax charged on the checkout.
      - name: total_price
        description: Full price of the checkout including shipping and tax.
      - name: requires_shipping
        description: Boolean indicating whether or not the checkout contains items that require shipping.
      - name: shipping_rate_title
        description: The type of shipping rate.
      - name: shipping_rate_name
      - name: shipping_rate_code
      - name: shipping_rate_description
      - name: shipping_rate_price
        description: The price of the shipping rate, with the associated defined shipping_rate_code.
      - name: shipping_rate_checkout_subtotal_price
      - name: shipping_rate_checkout_total_tax
      - name: shipping_rate_checkout_total_price
      - name: shipping_rate_delivery_range
      - name: shipping_rate_handle
        description: The handle of the shipping rate.
      - name: shipping_rate_phone_required
      - name: note_attributes
        description: Array of list name-value pairs for custom attributes.
      - name: billing_address_full_name
        description: The full name of the billing address associated with the customer.
      - name: billing_address_line_1
        description: The first line of the billing address.
      - name: billing_address_line_2
        description: Any additional information associated with the billing address.
      - name: billing_address_city
        description: The city of the billing address.
      - name: billing_address_province
        description: The province or state name of the billing address.
      - name: billing_address_zip
        description: The zip or post code of the billing address.
      - name: billing_address_country
        description: The country of the billing address.
      - name: billing_address_company
        description: The company name of the billing address.
      - name: billing_address_phone
        description: The phone number of the billing address.
      - name: shipping_address_full_name
        description: The full name of the shipping address associated with the customer.
      - name: shipping_address_line_1
        description: The first line of the shipping address.
      - name: shipping_address_line_2
        description: Any additional information associated with the shipping address.
      - name: shipping_address_city
        description: The city of the shipping address.
      - name: shipping_address_province
        description: The province or state name of the shipping address.
      - name: shipping_address_zip
        description: The zip or post code of the shipping address.
      - name: shipping_address_country
        description: The country of the shipping address.
      - name: shipping_address_company
        description: The company name of the shipping address.
      - name: shipping_address_phone
        description: The phone number of the shipping address.
      - name: shipping_address_validations_country_is_supported
        description: Boolean indicating if the shipping address country is supported.
      - name: shipping_address_validations_ups
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__checkout_line_item
    description: Table of all line items to their associated checkout.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - checkout_id
            - index

    columns:
      - name: checkout_id
        description: The unique ID for the checkout.
        tests:
          - not_null
      - name: index
        description: A unique numeric row produced for every concurrent checkout_id.
      - name: product_id
        description: An object containing the associated product ID as it appears in the external system.
      - name: variant_id
        description: An object containing the associated variant ID as it appears in the external system.
      - name: image
        description: An object containing URLS of the product image.
      - name: title
        description: The title of the product associated with the line item.
      - name: type
        description: The type of the product associated with the line item.
        tests:
          - accepted_values:
              values: ['SUBSCRIPTION','ONETIME']
              config:
                severity: warn
      - name: variant_title
        description: The title of the product variant associated with the line item.
      - name: vendor
        description: The seller of the products.
      - name: taxable
        description: Boolean indicating if the line item is taxable.
      - name: requires_shipping
        description: Boolean indicating whether or not the line item requires shipping.
      - name: sku
        description: The sku (stock keeping unit) of the product associated with the checkout line item.
      - name: tax_code
      - name: cutoff_day_of_month
        description: Day of the month the plan should be charged.
      - name: cutoff_day_of_week
        description: Day of the week the plan should be charged.
      - name: expire_after_specific_number_of_charges
        description: A maximum number of charges on which the subscription should appear before automatic cancellation.
      - name: first_recurring_charge_delay
      - name: fulfillment_service
      - name: grams
        description: The weight of the line item.
      - name: quantity
        description: The quantity of the item being purchased.
      - name: charge_interval_frequency
        description: Frequency at which the subscriber will be charged.
      - name: order_interval_frequency
        description: Frequency at which the subscriber will receive shipments on their plan.
      - name: order_interval_unit
        description: The unit applied to order_interval_frequency.
      - name: line_item_price
        description: The price of a single unit of the Product associated with the line item.
      - name: order_day_of_month
        description: Day of month an order should be generated when a customer is subscribed.
      - name: order_day_of_week
        description: Day of week an order should be generated when a customer is subscribed.
      - name: original_price
        description: The original price of the line item.
      - name: price
        description: The price of the line item.
      - name: product_type
        description: The type of the product associated with the line item.
      - name: recurring_price
        description: The recurring price that the subscriber will be charged.
      - name: properties
        description: Array of custom information associated with the line item.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.

  - name: stg_recharge__customer
    description: Table of all customer details holding account and billing information. Email is unique on the customer, no two customers for a store can have the same email.
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - customer_id
    
    columns:
      - name: customer_id
        description: The unique ID of the customer.
        tests:
          - not_null
      - name: hash
        description: The unique string identifier used in a customer portal link.
      - name: shopify_customer_id
        description: Shopify's unique identifier for the customer.
      - name: email
        description: The email address of the customer.
      - name: customer_full_name
        description: The full name of the customer.
      - name: created_at
        description: The date and time when the customer was created.
      - name: customer_status
        description: The status of the customer.
        tests:
          - accepted_values:
              values: ['ACTIVE','INACTIVE','ONETIMER']
              config:
                severity: warn
      - name: updated_at
        description: The date and time when the customer was last updated.
      - name: first_charge_processed_at
        description: Date when first charge was processed for the customer.
      - name: active_subscriptions
        description: The number of active subscriptions for the customer.
      - name: total_subscriptions
        description: The number of subscriptions the customer has.
      - name: customer_billing_full_name
        description: The full name of the customer's billing address.
      - name: billing_company
        description: The company name of the customer's billing address.
      - name: billing_address_line_1
        description: The first line of the customer's billing address.
      - name: billing_address_line_2
        description: An additional field for the customer's billing address.
      - name: billing_zip
        description: An additional field for the customer's billing address.
      - name: billing_city
        description: The customer's billing city.
      - name: billing_province
        description: The customer's billing province or state name.
      - name: billing_country
        description: The customer's billing country.
      - name: billing_phone
        description: The customer's billing phone.
      - name: processor_type
        description: What the merchant processor the customer is stored on.
        tests:
          - accepted_values:
              values: ['braintree','stripe','NULL']
              config:
                severity: warn
      - name: has_valid_payment_method
        description: Boolean indicating if the payment value is valid.
      - name: reason_payment_method_not_valid
        description: Field indicating why the payment method is not valid.
        tests:
          - accepted_values:
              values: ['MAX_RETRIES','NON_WORKING_PAYMENT_METHOD','NOT_VALIDATED','NO_PAYMENT_METHOD','NULL']
              config:
                severity: warn
      - name: has_card_error_in_dunning
        description: Boolean indicating if the customer has a credit card in dunning.
      - name: _fivetran_deleted
        description: Boolean indicating if a row have been deleted in the source.
      - name: _fivetran_synced
        description: Timestamp indicating when Fivetran last successfully synced the row.